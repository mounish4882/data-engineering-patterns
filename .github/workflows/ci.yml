name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  lint:
    name: Code Quality Checks
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install linting tools
        run: |
          python -m pip install --upgrade pip
          pip install black pylint mypy isort flake8

      - name: Check code formatting (Black)
        run: |
          black --check --line-length 100 . || echo "::warning::Code formatting issues found. Run 'black .' to fix."
        continue-on-error: true

      - name: Check import sorting (isort)
        run: |
          isort --check-only --profile black . || echo "::warning::Import sorting issues found. Run 'isort .' to fix."
        continue-on-error: true

      - name: Lint with flake8
        run: |
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        continue-on-error: true

  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Lint Markdown files
        uses: actionshub/markdownlint@main
        continue-on-error: true

  link-check:
    name: Check Links
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check links in Markdown
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          config-file: '.github/markdown-link-check-config.json'
        continue-on-error: true

  validate-structure:
    name: Validate Repository Structure
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check required files
        run: |
          echo "Checking for required files..."

          required_files=(
            "README.md"
            "CONTRIBUTING.md"
            "LICENSE"
            ".gitignore"
          )

          all_present=true
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "::error::Missing required file: $file"
              all_present=false
            else
              echo "âœ“ Found: $file"
            fi
          done

          if [ "$all_present" = false ]; then
            exit 1
          fi

          echo "All required files present!"

  pr-labeler:
    name: PR Labeler
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - uses: actions/labeler@v4
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
